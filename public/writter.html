<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Writter</title>
		<meta name="generator" content="Geany 1.36" />
	</head>

	<body>
		<h1>Writter</h1>
		<textarea id="text" spellcheck="false" 
		placeholder="Write here the JSON variables"></textarea>
		<br>
		<iframe id="preview"></iframe>
	</body>


	<style>
		html
		{
			display: flex;
			align-items: center;
			justify-content: center;
			font-family: sans-serif;
			text-align: center;
		}
		body {
			background-color: #eee;
		}
		textarea, iframe
		{
			resize: none;
			width: 400px;
			height: 200px;
			margin-bottom: 30px;
			background-color: #eee;
		}
		input
		{
			margin-bottom: 20px;
		}
		button
		{
			width: 70px;
			display: block;
			margin: auto;
			margin-bottom: 20px;
		}
		textarea, button, iframe, input
		{
			border-color: blue;
			border-radius: 4px;
		}
		button:active
		{
			transform: translateY(2px);
		}
	</style>


	<script>
		let data = {
			"title": "A title",
			"texts": [
				"A normal text",
				"A other normal text",
			],
			"style": {
				"color": "black",
				"backgroundColor": "white",
				"font": "cursive",
				"align": "center"
			}
		};

		const preview = document.getElementById('preview')

		document.getElementById("text").value = JSON.stringify(data, null, 3);
		
		function print (n)
		{
			try
			{
				preview.srcdoc = "";
				if (document.getElementById("reload"))
				{
					document.getElementById("reload").remove();
				}
				
				data = JSON.parse(document.getElementById("text").value);
				const currenttext = JSON.parse(document.getElementById("text").value);
				
				preview.srcdoc += `<h1>${currenttext.title}</h1>`

				currenttext.texts.forEach(text => {
					preview.srcdoc += 
					`<p>${text}</p>`
				});
				preview.srcdoc += 
				"<style> html { color: " + data.style.color + 
				"; background-color: " + data.style.backgroundColor + 
				"; font-family: " + data.style.font + 
				"; text-align: " + data.style.align +"} </style>";
			}
			catch (error)
			{
				if (!document.getElementById("reload"))
				{
					document.getElementById("preview").srcdoc = 
					"<p>" + error +"</p> <style> html { color: red;} </style>";
					const button = document.createElement("button");
					button.textContent = "Reload";
					button.id = "reload";
					document.body.appendChild(button);
					button.addEventListener("click", () => {
						location.reload();
					});
				}
			}
			
		} 

		document.addEventListener("keyup", () => {
			print(Object.keys(data).length);
		});

		print(Object.keys(data).length);
	</script>
</html>